"use strict";(self.webpackChunkmaterial_pro_angular_lite=self.webpackChunkmaterial_pro_angular_lite||[]).push([[828],{7828:(ct,T,s)=>{s.r(T),s.d(T,{SupportModule:()=>lt});var c=s(4755),x=s(2480),S=s(5861),h=s(3276),A=s(1634),m=s(5580),t=s(2223),u=s(3144),v=s(4004),g=s(2548);let Z=(()=>{class o{constructor(e){this.http=e}getsupportData(e){const n=`${g.ij.LIVE_URL}/user-account/list-support`,r=new u.WM({Authorization:`Bearer ${e.token}`}),i=(new u.LE).set("page",e.page).set("limit",e.limit);return this.http.get(n,{headers:r,params:i}).pipe((0,v.U)(l=>l))}getsupportUserData(e){const n=`${g.ij.LIVE_URL}/user-account/support-byId`,r=new u.WM({Authorization:`Bearer ${e.token}`}),i=(new u.LE).set("supportId",e.supportId);return this.http.get(n,{headers:r,params:i}).pipe((0,v.U)(l=>l))}replyToUser(e){return this.http.post(`${g.ij.LIVE_URL}/user-account/support-reply`,e)}resolved(e){const n=new u.WM({Authorization:`Bearer ${e.token}`});return this.http.post(`${g.ij.LIVE_URL}/user-account/support-resolved`,e,{headers:n})}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(u.eN))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var d=s(6081),f=s(9401),_=s(430),D=s(8097),C=s(3649),M=s(9383);const U=["chatContainer"];function w(o,a){1&o&&(t.TgZ(0,"div",14),t._UZ(1,"ngx-ui-loader",15),t.qZA()),2&o&&(t.xp6(1),t.Q6J("hasProgressBar",!1))}const I=function(o,a){return{left:o,right:a}};function O(o,a){if(1&o&&(t.TgZ(0,"div",16)(1,"p",17),t._uU(2),t.qZA(),t.TgZ(3,"p",18),t._uU(4),t.qZA()()),2&o){const e=a.$implicit,n=t.oxw();t.Q6J("ngClass",t.WLB(3,I,"issue"===e.type,"replies"===e.type)),t.xp6(2),t.Oqu(e.text),t.xp6(2),t.Oqu(n.getTimeDifference(e.timestamp))}}let R=(()=>{class o{constructor(e,n,r){this.supportService=e,this.dialogRef=n,this.data=r,this.replyMessage="",this.chatData=[],this.showLoader=!1;let i=localStorage.getItem("userinfo");i&&(this.parseData=JSON.parse(i))}ngOnInit(){this.getSupport(),this.supportInterval=setInterval(()=>{this.getSupport()},1e4)}ngOnDestroy(){clearInterval(this.supportInterval)}ngAfterViewChecked(){this.scrollToBottom()}scrollToBottom(){try{this.chatContainer.nativeElement.scrollTop=this.chatContainer.nativeElement.scrollHeight}catch{}}getSupport(){this.supportService.getsupportUserData({token:this.parseData.token,supportId:this.data.id}).subscribe(n=>{if(this.clientData=n.data,this.clientData.issue&&Array.isArray(this.clientData.issue))for(let r=0;r<this.clientData.issue.length;r++)this.clientData.issue[r].type="issue";if(this.clientData.replies&&Array.isArray(this.clientData.replies))for(let r=0;r<this.clientData.replies.length;r++)this.clientData.replies[r].type="replies";this.sortedMessages=this.sortMessages([...this.clientData.issue||[],...this.clientData.replies||[]])})}sortMessages(e){return e.sort((n,r)=>new Date(n.timestamp).getTime()-new Date(r.timestamp).getTime())}getTimeDifference(e){const n=new Date(e).getTime(),r=Date.now(),i=Math.floor((r-n)/6e4);return i<1?"Just now":i<60?i+" min ago":i<1440?Math.floor(i/60)+" hours "+i%60+" min ago":i<17280?Math.floor(i/1440)+" days "+Math.floor(i%1440/60)+" hours ago":Math.floor(i/1440)+" days ago"}replyToUser(){this.replyMessage.length>0&&this.supportService.replyToUser({supportId:this.data.id,replies:this.replyMessage}).subscribe(n=>{n&&(this.getSupport(),this.replyMessage="")})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(Z),t.Y36(m.so),t.Y36(m.WI))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-reply"]],viewQuery:function(e,n){if(1&e&&t.Gf(U,5),2&e){let r;t.iGM(r=t.CRH())&&(n.chatContainer=r.first)}},decls:18,vars:5,consts:[["class","ngxLoader",4,"ngIf"],[1,"toolbar"],[2,"text-transform","capitalize"],[1,"spacer"],["mat-dialog-close","","matTooltip","Close",1,"pointer"],[2,"height","400px"],["id","chat_container",1,"chat_container"],["chatContainer",""],["class","message",3,"ngClass",4,"ngFor","ngForOf"],[1,"reply_container"],[1,"replyField"],["matInput","","placeholder","Send a message...",1,"searchInput",3,"ngModel","ngModelChange","keyup.enter"],["input",""],["matTooltip","Send",1,"sendIcon",3,"click"],[1,"ngxLoader"],[3,"hasProgressBar"],[1,"message",3,"ngClass"],[1,"messages"],[1,"timestamp"]],template:function(e,n){1&e&&(t.YNc(0,w,2,1,"div",0),t.TgZ(1,"div",1)(2,"mat-toolbar",1)(3,"span",2),t._uU(4),t.qZA(),t._UZ(5,"div",3),t.TgZ(6,"mat-icon",4),t._uU(7,"close"),t.qZA()()(),t.TgZ(8,"div",5)(9,"div",6,7),t.YNc(11,O,5,6,"div",8),t.qZA(),t.TgZ(12,"div",9)(13,"div",10)(14,"input",11,12),t.NdJ("ngModelChange",function(i){return n.replyMessage=i})("keyup.enter",function(){return n.replyToUser()}),t.qZA(),t.TgZ(16,"mat-icon",13),t.NdJ("click",function(){return n.replyToUser()}),t._uU(17,"send"),t.qZA()()()()),2&e&&(t.Q6J("ngIf",n.showLoader),t.xp6(4),t.AsE("",n.data.user.firstName," ",n.data.user.lastName,""),t.xp6(7),t.Q6J("ngForOf",n.sortedMessages),t.xp6(3),t.Q6J("ngModel",n.replyMessage))},dependencies:[c.mk,c.sg,c.O5,d.Eo,f.Fj,f.JJ,f.On,_.Hw,D.Nt,C.gM,M.Ye,m.ZT],styles:[".toolbar[_ngcontent-%COMP%]{background-color:#1e88e5;color:#fff}.reply_container[_ngcontent-%COMP%]{align-items:baseline;text-align:center}.replyField[_ngcontent-%COMP%]{width:400px;display:flex;align-self:baseline;margin:20px}.replyField[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:400px;height:45px;border:1px solid #CCCBCB;border-radius:25px;background-color:#fff;padding-left:15px}.replyField[_ngcontent-%COMP%]   .sendIcon[_ngcontent-%COMP%]{width:20px;height:20px;color:#8c8888;background-color:#fff;margin-left:-32px;margin-top:10px;cursor:pointer}.replyField[_ngcontent-%COMP%]   .sendIcon[_ngcontent-%COMP%]:hover{color:#464141}.chat_container[_ngcontent-%COMP%]{padding:5px}.chat_container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:300px;overflow-y:scroll}.message[_ngcontent-%COMP%]{padding:5px;margin:5px;max-width:70%;word-wrap:break-word;line-height:20px}.message[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin:5px}.message[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-size:10px;text-align:right;margin-bottom:0;margin-top:2px}.message.left[_ngcontent-%COMP%]{align-self:flex-start;background-color:#f0f0f0;border-radius:5px}.message.right[_ngcontent-%COMP%]{align-self:flex-end;background-color:#d5e8d4;border-radius:5px}"]}),o})();var N=s(2342),p=s(3627);function P(o,a){1&o&&(t.TgZ(0,"div",26),t._UZ(1,"ngx-ui-loader",27),t.qZA()),2&o&&(t.xp6(1),t.Q6J("hasProgressBar",!1))}function k(o,a){1&o&&(t.TgZ(0,"th",28),t._uU(1,"Name "),t.qZA())}function Y(o,a){if(1&o&&(t.TgZ(0,"td",29),t._uU(1),t.qZA()),2&o){const e=a.$implicit;t.xp6(1),t.AsE(" ",e.user.firstName," ",e.user.lastName," ")}}function L(o,a){1&o&&(t.TgZ(0,"th",28),t._uU(1,"Email"),t.qZA())}function E(o,a){if(1&o&&(t.TgZ(0,"td",30),t._uU(1),t.qZA()),2&o){const e=a.$implicit;t.xp6(1),t.hij(" ",e.user.email," ")}}function J(o,a){1&o&&(t.TgZ(0,"th",28),t._uU(1,"Ticket No"),t.qZA())}function Q(o,a){if(1&o&&(t.TgZ(0,"td",31),t._uU(1),t.qZA()),2&o){const e=a.$implicit;t.xp6(1),t.hij(" ",e.ticketNo," ")}}function B(o,a){1&o&&(t.TgZ(0,"th",28),t._uU(1,"Title "),t.qZA())}function b(o,a){if(1&o&&(t.TgZ(0,"td",32),t._uU(1),t.qZA()),2&o){const e=a.$implicit;t.xp6(1),t.hij(" ",e.title," ")}}function z(o,a){1&o&&(t.TgZ(0,"th",28),t._uU(1,"Date & Time"),t.qZA())}const F=function(o){return{color:o}};function $(o,a){if(1&o&&(t.TgZ(0,"td",33),t._uU(1),t.ALo(2,"date"),t.qZA()),2&o){const e=a.$implicit;t.Q6J("ngStyle",t.VKq(5,F,"PENDING"===e.status?"#f5bb8c":"green")),t.xp6(1),t.hij(" ",t.xi3(2,2,e.createdAt,"MMMM dd, y , hh:mm:ss a")," ")}}function q(o,a){1&o&&(t.TgZ(0,"th",28),t._uU(1,"Status"),t.qZA())}function j(o,a){1&o&&(t.TgZ(0,"span",36),t._uU(1,"PENDING"),t.qZA())}function G(o,a){1&o&&(t.TgZ(0,"span",37),t._uU(1,"RESOLVED"),t.qZA())}function H(o,a){if(1&o&&(t.TgZ(0,"td",30),t.YNc(1,j,2,0,"span",34),t.YNc(2,G,2,0,"span",35),t.qZA()),2&o){const e=a.$implicit;t.xp6(1),t.Q6J("ngIf","PENDING"==e.status),t.xp6(1),t.Q6J("ngIf","RESOLVED"==e.status)}}function V(o,a){1&o&&(t.TgZ(0,"th",38),t._uU(1,"Message"),t.qZA())}function W(o,a){if(1&o&&(t.TgZ(0,"td",30),t._uU(1),t.qZA()),2&o){const e=a.$implicit;t.xp6(1),t.hij(" ",e.issue&&e.issue[0].text||"--"," ")}}function X(o,a){1&o&&(t.TgZ(0,"th",28),t._uU(1," Action"),t.qZA())}function K(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"mat-icon",41),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().$implicit,i=t.oxw();return t.KtG(i.reply(r))}),t._uU(1,"reply"),t.qZA()}}function tt(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"mat-icon",42),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().$implicit,i=t.oxw();return t.KtG(i.supportResolved(r))}),t._uU(1,"remove_circle"),t.qZA()}}function et(o,a){if(1&o&&(t.TgZ(0,"td",30),t.YNc(1,K,2,0,"mat-icon",39),t.YNc(2,tt,2,0,"mat-icon",40),t.qZA()),2&o){const e=a.$implicit;t.xp6(1),t.Q6J("ngIf","PENDING"==e.status),t.xp6(1),t.Q6J("ngIf","PENDING"==e.status)}}function ot(o,a){1&o&&t._UZ(0,"tr",43)}function nt(o,a){1&o&&t._UZ(0,"tr",44)}function at(o,a){1&o&&(t.TgZ(0,"tr",45)(1,"td",46),t._uU(2,"No data matching the filter "),t.qZA()())}const rt=function(){return[15,25,50,75,100]},it=[{path:"",component:(()=>{class o{constructor(e,n,r,i){this.supportService=e,this.ngxService=n,this.matdialog=r,this._snackBar=i,this.displayedColumns=["name","email","ticket","title","status","time","message","reply"],this.dataSource=[],this.showLoader=!1,this.newTicketIssue="";let l=localStorage.getItem("userinfo");l&&(this.parseData=JSON.parse(l))}ngOnInit(){this.initializeFilter(),this.getData()}getData(){var e=this;return(0,S.Z)(function*(){yield e.getSupport()})()}initializeFilter(){this.filter={token:this.parseData.token,page:1,limit:15}}getSupport(){var e=this;return(0,S.Z)(function*(){e.showLoader=!0,e.ngxService.start();try{const n=yield e.supportService.getsupportData(e.filter).toPromise();e.dataSource=n.data.results,e.Replies=n.data.results[0].issue[0],e.totalLength=n.data.count,e.showLoader=!1}catch{e.showLoader=!1}})()}pageChange(e){this.filter.page=e.pageIndex+1,this.filter.limit=e.pageSize,this.getSupport()}reply(e){this.matdialog.open(R,{width:"450px",data:e})}supportResolved(e){this.matdialog.open(A.w,{width:"300px",maxHeight:"400px"}).afterClosed().subscribe(n=>{n&&this.__supportResolved(e)})}__supportResolved(e){try{this.supportService.resolved({token:this.parseData.token,supportId:e.id,status:"RESOLVED"}).toPromise().then(()=>{this._snackBar.open("Ticket Resolved","Close",{duration:5e3,verticalPosition:"bottom",horizontalPosition:"center"}),this.getData()}).catch(i=>{console.error("Error:",i)})}catch(n){console.error("Error:",n)}}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(Z),t.Y36(d.LA),t.Y36(m.uw),t.Y36(N.ux))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-support"]],viewQuery:function(e,n){if(1&e&&t.Gf(h.NW,7),2&e){let r;t.iGM(r=t.CRH())&&(n.paginator=r.first)}},decls:36,vars:7,consts:[["class","ngxLoader",4,"ngIf"],[1,"main_container"],[1,"flex","pad-8","header"],[1,"heading"],[1,"spacer"],[2,"margin-top","10px"],["mat-table","",1,"dataTable",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","capital",4,"matCellDef"],["matColumnDef","email"],["mat-cell","",4,"matCellDef"],["matColumnDef","ticket"],["mat-cell","","style","padding-left: 30px;",4,"matCellDef"],["matColumnDef","title"],["mat-cell","","style","color: red; text-transform: capitalize;",4,"matCellDef"],["matColumnDef","time"],["mat-cell","",3,"ngStyle",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","message"],["mat-header-cell","","style","width: 15%; word-wrap:normal;",4,"matHeaderCellDef"],["matColumnDef","reply"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","cursor-pointer",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["pageSize","15",1,"pagination",3,"length","pageSizeOptions","page"],[1,"ngxLoader"],[3,"hasProgressBar"],["mat-header-cell",""],["mat-cell","",1,"capital"],["mat-cell",""],["mat-cell","",2,"padding-left","30px"],["mat-cell","",2,"color","red","text-transform","capitalize"],["mat-cell","",3,"ngStyle"],["style","color: #f5bb8c;",4,"ngIf"],["style","color: green;",4,"ngIf"],[2,"color","#f5bb8c"],[2,"color","green"],["mat-header-cell","",2,"width","15%","word-wrap","normal"],["class","pointer reply","matTooltip","Reply To User",3,"click",4,"ngIf"],["class","remove","matTooltip","Resolve Ticket",3,"click",4,"ngIf"],["matTooltip","Reply To User",1,"pointer","reply",3,"click"],["matTooltip","Resolve Ticket",1,"remove",3,"click"],["mat-header-row",""],["mat-row","",1,"cursor-pointer"],[1,"mat-row"],["colspan","5",1,"pad-16",2,"text-align","center"]],template:function(e,n){1&e&&(t.YNc(0,P,2,1,"div",0),t.TgZ(1,"div",1)(2,"div",2)(3,"p",3),t._uU(4,"Support "),t.qZA(),t._UZ(5,"div",4),t.qZA(),t.TgZ(6,"div",5)(7,"table",6),t.ynx(8,7),t.YNc(9,k,2,0,"th",8),t.YNc(10,Y,2,2,"td",9),t.BQk(),t.ynx(11,10),t.YNc(12,L,2,0,"th",8),t.YNc(13,E,2,1,"td",11),t.BQk(),t.ynx(14,12),t.YNc(15,J,2,0,"th",8),t.YNc(16,Q,2,1,"td",13),t.BQk(),t.ynx(17,14),t.YNc(18,B,2,0,"th",8),t.YNc(19,b,2,1,"td",15),t.BQk(),t.ynx(20,16),t.YNc(21,z,2,0,"th",8),t.YNc(22,$,3,7,"td",17),t.BQk(),t.ynx(23,18),t.YNc(24,q,2,0,"th",8),t.YNc(25,H,3,2,"td",11),t.BQk(),t.ynx(26,19),t.YNc(27,V,2,0,"th",20),t.YNc(28,W,2,1,"td",11),t.BQk(),t.ynx(29,21),t.YNc(30,X,2,0,"th",8),t.YNc(31,et,3,2,"td",11),t.BQk(),t.YNc(32,ot,1,0,"tr",22),t.YNc(33,nt,1,0,"tr",23),t.YNc(34,at,3,0,"tr",24),t.qZA(),t.TgZ(35,"mat-paginator",25),t.NdJ("page",function(i){return n.pageChange(i)}),t.qZA()()()),2&e&&(t.Q6J("ngIf",n.showLoader),t.xp6(7),t.Q6J("dataSource",n.dataSource),t.xp6(25),t.Q6J("matHeaderRowDef",n.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",n.displayedColumns),t.xp6(2),t.Q6J("length",n.totalLength)("pageSizeOptions",t.DdM(6,rt)))},dependencies:[c.O5,c.PC,p.BZ,p.fO,p.as,p.w1,p.Dz,p.nj,p.ge,p.ev,p.XQ,p.Gk,p.Ee,h.NW,d.Eo,_.Hw,C.gM,c.uU],styles:[".main_container[_ngcontent-%COMP%]{padding:0 10px}.reply[_ngcontent-%COMP%]{margin-right:5px}.reply[_ngcontent-%COMP%]:hover{color:#1e88e5}.remove[_ngcontent-%COMP%]:hover{cursor:pointer;color:green}"]}),o})()}];let st=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[x.Bz.forChild(it),x.Bz]}),o})();var pt=s(1728);let lt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[c.ez,st,p.p0,h.TU,d.Js,f.u5,_.Ps,D.c,C.AV,M.g0,m.Is,pt.ot,N.ZX]}),o})()}}]);